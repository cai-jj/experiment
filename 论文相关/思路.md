

![图片.drawio](https://note-1322176778.cos.ap-guangzhou.myqcloud.com/java/juc/%E5%9B%BE%E7%89%87.drawio.png)

## 威胁攻击

依次访问所有的web页面，进行指纹构造。

**构造指纹**

每个web 页面的主`ip`和托管的`ip`

```java
{ip} + {ip1, ip2, ..., ipn}
```

**IP 权重**

如果一个web页面仅仅只对应一个单独的ip，那每个ip被联系到的概率为
$$
p(ip) = 1 / web页面的数量
$$
有了托管ip后，每个ip的概率为 
$$
p(ip) = ip在所有web页面出现的次数 / web页面的数量
$$


ip概率越低，说明这个ip与托管该web 页面的联系越紧密，那么权重就越大。

定义 IP权重为
$$
W(IP) = -log2p(ip)
$$

**IP识别**

捕捉到用户与服务器之间的一组`ip`序列，将`ip`序列与构造好的数据集进行比对，先选出主ip存在于ip序列的指纹，加入集合中，再把集合中的每个指纹的托管ip与`ip`序列进行比对，相同就把权值加上，选择指纹中权重最大的那个ip。

## 防御措施

多台服务器存放相同的图片，web页面需要这个图片，每次就可以选择一个ip，每次选择的会影响该ip在web页面出现的次数，从而影响ip的权重（偏高或者偏低），我们的识别结果判断就是根据ip权重进行判断，肯定会影响识别结果。

换句话说，也就是ip权重对于识别结果的影响失效了（**算不算差分隐私？**）

我们针对提取的构造指纹满足k > 2的匿名算法，每次进行结果比对，至少有两个以上的`ip`序列符合条件，那么只能随机挑一个`ip`作为本次预测结果。

图片不能固定存放在某台服务器上，如果固定，IP权值就是固定的，那么结果就是固定的。

+ 每个图片对应一个ip地址，每个页面都含有所有的ip地址，ip权重计算的是一样的，无法区分哪个IP序列是访问了ip地址
+ 每个图片对应好几个服务器ip地址，根据ip选择策略选择指定的ip地址。

## 实验

8台虚拟机、一台主机、80张图片资源

```java
 cd /etc/sysconfig/network-scripts/

IPADDR=192.168.100.60
GATEWAY=192.168.100.2
DNS1=192.168.100.2
NETMASK=255.255.255.0
```

**ip配置**

**同一台电脑虚拟机无法配置不同局部网（假设最后的ip差大于等于10就不在同一网段）**

```java
服务器ip
    192.168.100.10  2
    192.168.100.11  3
    
    192.168.100.20  4
    192.168.100.21  5
    
    192.168.100.30  6
    192.168.100.31  7
    
    192.168.100.40  8
    192.168.100.41  9
     
每个网页对应的图片：
index1.html:  192.168.100.10
    1.jpg 2.jpg 3.jpg 4.jpg 5.jpg 6.jpg 7.jpg 8.jpg 9.jpg 10.jpg
index2.html:  192.168.100.11
11.jpg 12.jpg 13.jpg 14.jpg 15.jpg 16.jpg 17.jpg 18.jpg 19.jpg 20.jpg
index3.html:  192.168.100.20
21.jpg 22.jpg 23.jpg 24.jpg 25.jpg 26.jpg 27.jpg 28.jpg 29.jpg 30.jpg
index4.html:  192.168.100.21
31.jpg 32.jpg 33.jpg 34.jpg 35.jpg 36.jpg 37.jpg 38.jpg 39.jpg 40.jpg
index5.html:   192.168.100.30
41.jpg 42.jpg 43.jpg 44.jpg 45.jpg 46.jpg 47.jpg 48.jpg 49.jpg 50.jpg
index6.html:   192.168.100.31
51.jpg 52.jpg 53.jpg 54.jpg 55.jpg 56.jpg 57.jpg 58.jpg 59.jpg 60.jpg
index7.html:  192.168.100.40
61.jpg 62.jpg 63.jpg 64.jpg 65.jpg 66.jpg 67.jpg 68.jpg 69.jpg 70.jpg
index8.html: 192.168.100.41
71.jpg 72.jpg 73.jpg 74.jpg 75.jpg 76.jpg 77.jpg 78.jpg 79.jpg 80.jpg
```

**图片存储策略，一张图片放在多个服务器上，服务器上怎么分布图片，怎么存放。**

n个资源存放在m个服务器上，每个资源对应多少个服务器，每个服务器存放多少资源？

```java
80个资源分布到8个服务器：根据图片的hash值对服务器数量取余数 + 重复次数（一张图片要映射到两个以上服务器）
构建图片和服务器之间的映射表  
8个服务器代表8个网站，主域名对应唯一，每个网站需要的图片固定。
```

### 1. 每张图片只对应一个资源

```java
=====================
8.jpg:[192.168.100.21]
31.jpg:[192.168.100.11]
23.jpg:[192.168.100.30]
14.jpg:[192.168.100.40]
66.jpg:[192.168.100.21]
15.jpg:[192.168.100.41]
58.jpg:[192.168.100.40]
75.jpg:[192.168.100.11]
32.jpg:[192.168.100.20]
49.jpg:[192.168.100.10]
48.jpg:[192.168.100.41]
30.jpg:[192.168.100.10]
56.jpg:[192.168.100.30]
9.jpg:[192.168.100.30]
65.jpg:[192.168.100.20]
13.jpg:[192.168.100.31]
39.jpg:[192.168.100.11]
40.jpg:[192.168.100.41]
22.jpg:[192.168.100.21]
57.jpg:[192.168.100.31]
74.jpg:[192.168.100.10]
80.jpg:[192.168.100.21]
17.jpg:[192.168.100.11]
50.jpg:[192.168.100.40]
6.jpg:[192.168.100.11]
5.jpg:[192.168.100.10]
21.jpg:[192.168.100.20]
64.jpg:[192.168.100.11]
77.jpg:[192.168.100.21]
34.jpg:[192.168.100.30]
47.jpg:[192.168.100.40]
16.jpg:[192.168.100.10]
29.jpg:[192.168.100.20]
51.jpg:[192.168.100.41]
7.jpg:[192.168.100.20]
76.jpg:[192.168.100.20]
63.jpg:[192.168.100.10]
20.jpg:[192.168.100.11]
59.jpg:[192.168.100.41]
46.jpg:[192.168.100.31]
33.jpg:[192.168.100.21]
36.jpg:[192.168.100.40]
61.jpg:[192.168.100.40]
79.jpg:[192.168.100.31]
3.jpg:[192.168.100.40]
28.jpg:[192.168.100.11]
53.jpg:[192.168.100.11]
45.jpg:[192.168.100.30]
10.jpg:[192.168.100.20]
19.jpg:[192.168.100.21]
60.jpg:[192.168.100.31]
78.jpg:[192.168.100.30]
18.jpg:[192.168.100.20]
43.jpg:[192.168.100.20]
62.jpg:[192.168.100.41]
4.jpg:[192.168.100.41]
26.jpg:[192.168.100.41]
27.jpg:[192.168.100.10]
52.jpg:[192.168.100.10]
70.jpg:[192.168.100.30]
44.jpg:[192.168.100.21]
35.jpg:[192.168.100.31]
12.jpg:[192.168.100.30]
55.jpg:[192.168.100.21]
42.jpg:[192.168.100.11]
68.jpg:[192.168.100.31]
25.jpg:[192.168.100.40]
69.jpg:[192.168.100.40]
38.jpg:[192.168.100.10]
1.jpg:[192.168.100.30]
71.jpg:[192.168.100.31]
24.jpg:[192.168.100.31]
73.jpg:[192.168.100.41]
2.jpg:[192.168.100.31]
37.jpg:[192.168.100.41]
11.jpg:[192.168.100.21]
41.jpg:[192.168.100.10]
54.jpg:[192.168.100.20]
67.jpg:[192.168.100.30]
72.jpg:[192.168.100.40]
====每个服务器对应的图片数量========
0:10
1:10
2:10
3:10
4:10
5:10
6:10
7:10
=========reverseTable==========
192.168.100.30:[1.jpg, 9.jpg, 12.jpg, 23.jpg, 34.jpg, 45.jpg, 56.jpg, 67.jpg, 70.jpg, 78.jpg]
192.168.100.41:[4.jpg, 15.jpg, 26.jpg, 37.jpg, 40.jpg, 48.jpg, 51.jpg, 59.jpg, 62.jpg, 73.jpg]
192.168.100.40:[3.jpg, 14.jpg, 25.jpg, 36.jpg, 47.jpg, 50.jpg, 58.jpg, 61.jpg, 69.jpg, 72.jpg]
192.168.100.10:[5.jpg, 16.jpg, 27.jpg, 30.jpg, 38.jpg, 41.jpg, 49.jpg, 52.jpg, 63.jpg, 74.jpg]
192.168.100.21:[8.jpg, 11.jpg, 19.jpg, 22.jpg, 33.jpg, 44.jpg, 55.jpg, 66.jpg, 77.jpg, 80.jpg]
192.168.100.31:[2.jpg, 13.jpg, 24.jpg, 35.jpg, 46.jpg, 57.jpg, 60.jpg, 68.jpg, 71.jpg, 79.jpg]
192.168.100.20:[7.jpg, 10.jpg, 18.jpg, 21.jpg, 29.jpg, 32.jpg, 43.jpg, 54.jpg, 65.jpg, 76.jpg]
192.168.100.11:[6.jpg, 17.jpg, 20.jpg, 28.jpg, 31.jpg, 39.jpg, 42.jpg, 53.jpg, 64.jpg, 75.jpg]
提取的ip列表为：
HostedIp{masterIp='192.168.100.10', secondIp=[192.168.100.30, 192.168.100.41, 192.168.100.40, 192.168.100.21, 192.168.100.31, 192.168.100.20, 192.168.100.11]}
HostedIp{masterIp='192.168.100.11', secondIp=[192.168.100.30, 192.168.100.41, 192.168.100.40, 192.168.100.21, 192.168.100.10, 192.168.100.31, 192.168.100.20]}
HostedIp{masterIp='192.168.100.20', secondIp=[192.168.100.30, 192.168.100.41, 192.168.100.40, 192.168.100.21, 192.168.100.10, 192.168.100.31, 192.168.100.11]}
HostedIp{masterIp='192.168.100.21', secondIp=[192.168.100.30, 192.168.100.41, 192.168.100.40, 192.168.100.10, 192.168.100.20, 192.168.100.31, 192.168.100.11]}
HostedIp{masterIp='192.168.100.30', secondIp=[192.168.100.41, 192.168.100.40, 192.168.100.10, 192.168.100.21, 192.168.100.20, 192.168.100.31, 192.168.100.11]}
HostedIp{masterIp='192.168.100.31', secondIp=[192.168.100.41, 192.168.100.30, 192.168.100.40, 192.168.100.10, 192.168.100.21, 192.168.100.20, 192.168.100.11]}
HostedIp{masterIp='192.168.100.40', secondIp=[192.168.100.41, 192.168.100.30, 192.168.100.10, 192.168.100.21, 192.168.100.20, 192.168.100.31, 192.168.100.11]}
HostedIp{masterIp='192.168.100.41', secondIp=[192.168.100.30, 192.168.100.40, 192.168.100.10, 192.168.100.21, 192.168.100.31, 192.168.100.20, 192.168.100.11]}
ip权重：
192.168.100.30:-0.0
192.168.100.41:-0.0
192.168.100.40:-0.0
192.168.100.10:-0.0
192.168.100.21:-0.0
192.168.100.20:-0.0
192.168.100.31:-0.0
192.168.100.11:-0.0
```

**根据上述数据，访问网站无法判断ip地址是哪一个**（ip权重都是一样，每个ip序列所包含的ip地址都是一样的）**k匿名算法构造**

如果数据包的流量资源是否是按照ip地址顺序访问的，如果根据资源访问的ip地址有序的化，可以判断唯一ip

### 2. 每张图片对应多个服务器

```java
8.jpg:[192.168.100.21, 192.168.100.30, 192.168.100.31]
31.jpg:[192.168.100.11, 192.168.100.20]
23.jpg:[192.168.100.30, 192.168.100.31, 192.168.100.40]
14.jpg:[192.168.100.40, 192.168.100.41, 192.168.100.10]
66.jpg:[192.168.100.21, 192.168.100.30, 192.168.100.31]
15.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11]
58.jpg:[192.168.100.40, 192.168.100.41]
75.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21]
32.jpg:[192.168.100.20, 192.168.100.21, 192.168.100.30, 192.168.100.31]
49.jpg:[192.168.100.10, 192.168.100.11, 192.168.100.20, 192.168.100.21]
48.jpg:[192.168.100.41, 192.168.100.10]
30.jpg:[192.168.100.10, 192.168.100.11]
56.jpg:[192.168.100.30, 192.168.100.31, 192.168.100.40, 192.168.100.41]
9.jpg:[192.168.100.30, 192.168.100.31]
65.jpg:[192.168.100.20, 192.168.100.21]
13.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41]
39.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21]
40.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11, 192.168.100.20]
22.jpg:[192.168.100.21, 192.168.100.30, 192.168.100.31, 192.168.100.40]
57.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41]
74.jpg:[192.168.100.10, 192.168.100.11]
80.jpg:[192.168.100.21, 192.168.100.30, 192.168.100.31]
17.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21]
50.jpg:[192.168.100.40, 192.168.100.41]
6.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21]
5.jpg:[192.168.100.10, 192.168.100.11, 192.168.100.20]
21.jpg:[192.168.100.20, 192.168.100.21, 192.168.100.30]
64.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21]
77.jpg:[192.168.100.21, 192.168.100.30, 192.168.100.31]
34.jpg:[192.168.100.30, 192.168.100.31, 192.168.100.40]
47.jpg:[192.168.100.40, 192.168.100.41, 192.168.100.10]
16.jpg:[192.168.100.10, 192.168.100.11, 192.168.100.20, 192.168.100.21]
29.jpg:[192.168.100.20, 192.168.100.21, 192.168.100.30, 192.168.100.31]
51.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11]
7.jpg:[192.168.100.20, 192.168.100.21]
76.jpg:[192.168.100.20, 192.168.100.21, 192.168.100.30]
63.jpg:[192.168.100.10, 192.168.100.11, 192.168.100.20]
20.jpg:[192.168.100.11, 192.168.100.20]
59.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11]
46.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41]
33.jpg:[192.168.100.21, 192.168.100.30]
36.jpg:[192.168.100.40, 192.168.100.41]
61.jpg:[192.168.100.40, 192.168.100.41, 192.168.100.10]
79.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41]
3.jpg:[192.168.100.40, 192.168.100.41]
28.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21]
53.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21, 192.168.100.30]
45.jpg:[192.168.100.30, 192.168.100.31]
10.jpg:[192.168.100.20, 192.168.100.21]
19.jpg:[192.168.100.21, 192.168.100.30, 192.168.100.31, 192.168.100.40]
60.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41, 192.168.100.10]
78.jpg:[192.168.100.30, 192.168.100.31]
18.jpg:[192.168.100.20, 192.168.100.21, 192.168.100.30]
43.jpg:[192.168.100.20, 192.168.100.21]
62.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11]
4.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11]
26.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11]
27.jpg:[192.168.100.10, 192.168.100.11]
52.jpg:[192.168.100.10, 192.168.100.11, 192.168.100.20, 192.168.100.21]
70.jpg:[192.168.100.30, 192.168.100.31, 192.168.100.40, 192.168.100.41]
44.jpg:[192.168.100.21, 192.168.100.30]
35.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41]
12.jpg:[192.168.100.30, 192.168.100.31, 192.168.100.40]
55.jpg:[192.168.100.21, 192.168.100.30]
42.jpg:[192.168.100.11, 192.168.100.20, 192.168.100.21, 192.168.100.30]
68.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41, 192.168.100.10]
25.jpg:[192.168.100.40, 192.168.100.41]
69.jpg:[192.168.100.40, 192.168.100.41, 192.168.100.10]
38.jpg:[192.168.100.10, 192.168.100.11, 192.168.100.20, 192.168.100.21]
1.jpg:[192.168.100.30, 192.168.100.31]
71.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41, 192.168.100.10]
24.jpg:[192.168.100.31, 192.168.100.40]
73.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11, 192.168.100.20]
2.jpg:[192.168.100.31, 192.168.100.40, 192.168.100.41, 192.168.100.10]
37.jpg:[192.168.100.41, 192.168.100.10, 192.168.100.11]
11.jpg:[192.168.100.21, 192.168.100.30, 192.168.100.31]
41.jpg:[192.168.100.10, 192.168.100.11, 192.168.100.20]
54.jpg:[192.168.100.20, 192.168.100.21]
67.jpg:[192.168.100.30, 192.168.100.31, 192.168.100.40]
72.jpg:[192.168.100.40, 192.168.100.41, 192.168.100.10]
====每个服务器对应图片的数量========
0:29
1:29
2:29
3:32
4:27
5:29
6:28
7:31
=========reverseTable==========
192.168.100.30:[1.jpg, 8.jpg, 9.jpg, 11.jpg, 12.jpg, 18.jpg, 19.jpg, 21.jpg, 22.jpg, 23.jpg, 29.jpg, 32.jpg, 33.jpg, 34.jpg, 42.jpg, 44.jpg, 45.jpg, 53.jpg, 55.jpg, 56.jpg, 66.jpg, 67.jpg, 70.jpg, 76.jpg, 77.jpg, 78.jpg, 80.jpg]
192.168.100.41:[2.jpg, 3.jpg, 4.jpg, 13.jpg, 14.jpg, 15.jpg, 25.jpg, 26.jpg, 35.jpg, 36.jpg, 37.jpg, 40.jpg, 46.jpg, 47.jpg, 48.jpg, 50.jpg, 51.jpg, 56.jpg, 57.jpg, 58.jpg, 59.jpg, 60.jpg, 61.jpg, 62.jpg, 68.jpg, 69.jpg, 70.jpg, 71.jpg, 72.jpg, 73.jpg, 79.jpg]
192.168.100.40:[2.jpg, 3.jpg, 12.jpg, 13.jpg, 14.jpg, 19.jpg, 22.jpg, 23.jpg, 24.jpg, 25.jpg, 34.jpg, 35.jpg, 36.jpg, 46.jpg, 47.jpg, 50.jpg, 56.jpg, 57.jpg, 58.jpg, 60.jpg, 61.jpg, 67.jpg, 68.jpg, 69.jpg, 70.jpg, 71.jpg, 72.jpg, 79.jpg]
192.168.100.10:[2.jpg, 4.jpg, 5.jpg, 14.jpg, 15.jpg, 16.jpg, 26.jpg, 27.jpg, 30.jpg, 37.jpg, 38.jpg, 40.jpg, 41.jpg, 47.jpg, 48.jpg, 49.jpg, 51.jpg, 52.jpg, 59.jpg, 60.jpg, 61.jpg, 62.jpg, 63.jpg, 68.jpg, 69.jpg, 71.jpg, 72.jpg, 73.jpg, 74.jpg]
192.168.100.21:[6.jpg, 7.jpg, 8.jpg, 10.jpg, 11.jpg, 16.jpg, 17.jpg, 18.jpg, 19.jpg, 21.jpg, 22.jpg, 28.jpg, 29.jpg, 32.jpg, 33.jpg, 38.jpg, 39.jpg, 42.jpg, 43.jpg, 44.jpg, 49.jpg, 52.jpg, 53.jpg, 54.jpg, 55.jpg, 64.jpg, 65.jpg, 66.jpg, 75.jpg, 76.jpg, 77.jpg, 80.jpg]
192.168.100.31:[1.jpg, 2.jpg, 8.jpg, 9.jpg, 11.jpg, 12.jpg, 13.jpg, 19.jpg, 22.jpg, 23.jpg, 24.jpg, 29.jpg, 32.jpg, 34.jpg, 35.jpg, 45.jpg, 46.jpg, 56.jpg, 57.jpg, 60.jpg, 66.jpg, 67.jpg, 68.jpg, 70.jpg, 71.jpg, 77.jpg, 78.jpg, 79.jpg, 80.jpg]
192.168.100.20:[5.jpg, 6.jpg, 7.jpg, 10.jpg, 16.jpg, 17.jpg, 18.jpg, 20.jpg, 21.jpg, 28.jpg, 29.jpg, 31.jpg, 32.jpg, 38.jpg, 39.jpg, 40.jpg, 41.jpg, 42.jpg, 43.jpg, 49.jpg, 52.jpg, 53.jpg, 54.jpg, 63.jpg, 64.jpg, 65.jpg, 73.jpg, 75.jpg, 76.jpg]
192.168.100.11:[4.jpg, 5.jpg, 6.jpg, 15.jpg, 16.jpg, 17.jpg, 20.jpg, 26.jpg, 27.jpg, 28.jpg, 30.jpg, 31.jpg, 37.jpg, 38.jpg, 39.jpg, 40.jpg, 41.jpg, 42.jpg, 49.jpg, 51.jpg, 52.jpg, 53.jpg, 59.jpg, 62.jpg, 63.jpg, 64.jpg, 73.jpg, 74.jpg, 75.jpg]
提取的ip列表为：
HostedIp{masterIp='192.168.100.10', secondIp=[192.168.100.41, 192.168.100.40, 192.168.100.21, 192.168.100.31, 192.168.100.20]}
HostedIp{masterIp='192.168.100.11', secondIp=[192.168.100.41, 192.168.100.21, 192.168.100.31, 192.168.100.20]}
HostedIp{masterIp='192.168.100.20', secondIp=[192.168.100.41, 192.168.100.30, 192.168.100.40, 192.168.100.21, 192.168.100.11]}
HostedIp{masterIp='192.168.100.21', secondIp=[192.168.100.30, 192.168.100.41, 192.168.100.40, 192.168.100.20, 192.168.100.31]}
HostedIp{masterIp='192.168.100.30', secondIp=[192.168.100.40, 192.168.100.21, 192.168.100.10, 192.168.100.20, 192.168.100.31, 192.168.100.11]}
HostedIp{masterIp='192.168.100.31', secondIp=[192.168.100.30, 192.168.100.41, 192.168.100.21, 192.168.100.10, 192.168.100.11]}
HostedIp{masterIp='192.168.100.40', secondIp=[192.168.100.41, 192.168.100.10, 192.168.100.21, 192.168.100.20, 192.168.100.31]}
HostedIp{masterIp='192.168.100.41', secondIp=[192.168.100.30, 192.168.100.40, 192.168.100.10, 192.168.100.21, 192.168.100.20, 192.168.100.31]}
ip权重：
192.168.100.30:0.6780719051126377
192.168.100.41:0.1926450779423959
192.168.100.40:0.4150374992788438
192.168.100.10:0.6780719051126377
192.168.100.21:-0.0
192.168.100.20:0.1926450779423959
192.168.100.31:0.1926450779423959
192.168.100.11:1.0
```

根据提取的映射关系和ip权重识别ip地址，使用自动化脚本访问所有页面访问3次的结果如下：

```java
本次访问的页面是index1
预测的ip地址为：192.168.100.41
真实的ip地址为：192.168.100.10
本次访问的页面是index2
预测的ip地址为：192.168.100.30
真实的ip地址为：192.168.100.11
本次访问的页面是index3
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.20
本次访问的页面是index4
预测的ip地址为：192.168.100.30
真实的ip地址为：192.168.100.21
本次访问的页面是index5
预测的ip地址为：192.168.100.41
真实的ip地址为：192.168.100.30
本次访问的页面是index6
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.31
本次访问的页面是index7
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.40
本次访问的页面是index8
预测的ip地址为：192.168.100.20
真实的ip地址为：192.168.100.41
    
本次访问的页面是index1
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.10
本次访问的页面是index2
预测的ip地址为：192.168.100.30
真实的ip地址为：192.168.100.11
本次访问的页面是index3
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.20   
本次访问的页面是index4
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.21
本次访问的页面是index5
预测的ip地址为：192.168.100.20
真实的ip地址为：192.168.100.30
本次访问的页面是index6
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.31
本次访问的页面是index7
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.40
本次访问的页面是index8
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.41
    
本次访问的页面是index1
预测的ip地址为：192.168.100.41
真实的ip地址为：192.168.100.10
本次访问的页面是index2
预测的ip地址为：192.168.100.20
真实的ip地址为：192.168.100.11
本次访问的页面是index3
预测的ip地址为：192.168.100.20
真实的ip地址为：192.168.100.20
本次访问的页面是index4
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.21
本次访问的页面是index4
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.21
本次访问的页面是index5
预测的ip地址为：192.168.100.20
真实的ip地址为：192.168.100.30
本次访问的页面是index6
预测的ip地址为：192.168.100.41
真实的ip地址为：192.168.100.31
本次访问的页面是index7
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.40
本次访问的页面是index8
预测的ip地址为：192.168.100.41
真实的ip地址为：192.168.100.41
```

### 3.每一类图片都在一个域名ip中

```java
=====================
8.jpg:[192.168.100.10]
31.jpg:[192.168.100.21]
23.jpg:[192.168.100.20]
14.jpg:[192.168.100.11]
66.jpg:[192.168.100.40]
15.jpg:[192.168.100.11]
58.jpg:[192.168.100.31]
75.jpg:[192.168.100.41]
32.jpg:[192.168.100.21]
49.jpg:[192.168.100.30]
48.jpg:[192.168.100.30]
30.jpg:[192.168.100.20]
56.jpg:[192.168.100.31]
9.jpg:[192.168.100.10]
65.jpg:[192.168.100.40]
13.jpg:[192.168.100.11]
39.jpg:[192.168.100.21]
40.jpg:[192.168.100.21]
22.jpg:[192.168.100.20]
57.jpg:[192.168.100.31]
74.jpg:[192.168.100.41]
80.jpg:[192.168.100.41]
17.jpg:[192.168.100.11]
50.jpg:[192.168.100.30]
6.jpg:[192.168.100.10]
5.jpg:[192.168.100.10]
21.jpg:[192.168.100.20]
64.jpg:[192.168.100.40]
77.jpg:[192.168.100.41]
34.jpg:[192.168.100.21]
47.jpg:[192.168.100.30]
16.jpg:[192.168.100.11]
29.jpg:[192.168.100.20]
51.jpg:[192.168.100.31]
7.jpg:[192.168.100.10]
76.jpg:[192.168.100.41]
63.jpg:[192.168.100.40]
20.jpg:[192.168.100.11]
59.jpg:[192.168.100.31]
46.jpg:[192.168.100.30]
33.jpg:[192.168.100.21]
36.jpg:[192.168.100.21]
61.jpg:[192.168.100.40]
79.jpg:[192.168.100.41]
3.jpg:[192.168.100.10]
28.jpg:[192.168.100.20]
53.jpg:[192.168.100.31]
45.jpg:[192.168.100.30]
10.jpg:[192.168.100.10]
19.jpg:[192.168.100.11]
60.jpg:[192.168.100.31]
78.jpg:[192.168.100.41]
18.jpg:[192.168.100.11]
43.jpg:[192.168.100.30]
62.jpg:[192.168.100.40]
4.jpg:[192.168.100.10]
26.jpg:[192.168.100.20]
27.jpg:[192.168.100.20]
52.jpg:[192.168.100.31]
70.jpg:[192.168.100.40]
44.jpg:[192.168.100.30]
35.jpg:[192.168.100.21]
12.jpg:[192.168.100.11]
55.jpg:[192.168.100.31]
42.jpg:[192.168.100.30]
68.jpg:[192.168.100.40]
25.jpg:[192.168.100.20]
69.jpg:[192.168.100.40]
38.jpg:[192.168.100.21]
1.jpg:[192.168.100.10]
71.jpg:[192.168.100.41]
24.jpg:[192.168.100.20]
73.jpg:[192.168.100.41]
2.jpg:[192.168.100.10]
37.jpg:[192.168.100.21]
11.jpg:[192.168.100.11]
41.jpg:[192.168.100.30]
54.jpg:[192.168.100.31]
67.jpg:[192.168.100.40]
72.jpg:[192.168.100.41]
====index========
0:10
1:10
2:10
3:10
4:10
5:10
6:10
7:10
=========reverseTable==========
192.168.100.30:[41.jpg, 42.jpg, 43.jpg, 44.jpg, 45.jpg, 46.jpg, 47.jpg, 48.jpg, 49.jpg, 50.jpg]
192.168.100.41:[71.jpg, 72.jpg, 73.jpg, 74.jpg, 75.jpg, 76.jpg, 77.jpg, 78.jpg, 79.jpg, 80.jpg]
192.168.100.40:[61.jpg, 62.jpg, 63.jpg, 64.jpg, 65.jpg, 66.jpg, 67.jpg, 68.jpg, 69.jpg, 70.jpg]
192.168.100.10:[1.jpg, 2.jpg, 3.jpg, 4.jpg, 5.jpg, 6.jpg, 7.jpg, 8.jpg, 9.jpg, 10.jpg]
192.168.100.21:[31.jpg, 32.jpg, 33.jpg, 34.jpg, 35.jpg, 36.jpg, 37.jpg, 38.jpg, 39.jpg, 40.jpg]
192.168.100.20:[21.jpg, 22.jpg, 23.jpg, 24.jpg, 25.jpg, 26.jpg, 27.jpg, 28.jpg, 29.jpg, 30.jpg]
192.168.100.31:[51.jpg, 52.jpg, 53.jpg, 54.jpg, 55.jpg, 56.jpg, 57.jpg, 58.jpg, 59.jpg, 60.jpg]
192.168.100.11:[11.jpg, 12.jpg, 13.jpg, 14.jpg, 15.jpg, 16.jpg, 17.jpg, 18.jpg, 19.jpg, 20.jpg]
提取的ip列表为：
HostedIp{masterIp='192.168.100.10', secondIp=[]}
HostedIp{masterIp='192.168.100.11', secondIp=[]}
HostedIp{masterIp='192.168.100.20', secondIp=[]}
HostedIp{masterIp='192.168.100.21', secondIp=[]}
HostedIp{masterIp='192.168.100.30', secondIp=[]}
HostedIp{masterIp='192.168.100.31', secondIp=[]}
HostedIp{masterIp='192.168.100.40', secondIp=[]}
HostedIp{masterIp='192.168.100.41', secondIp=[]}
ip权重：
192.168.100.30:3.0
192.168.100.41:3.0
192.168.100.40:3.0
192.168.100.10:3.0
192.168.100.21:3.0
192.168.100.20:3.0
192.168.100.31:3.0
192.168.100.11:3.0
```

**结果**

```java
本次访问的页面是index1
预测的ip地址为：192.168.100.10
真实的ip地址为：192.168.100.10
本次访问的页面是index2
预测的ip地址为：192.168.100.11
真实的ip地址为：192.168.100.11
本次访问的页面是index3
预测的ip地址为：192.168.100.20
真实的ip地址为：192.168.100.20
本次访问的页面是index4
预测的ip地址为：192.168.100.21
真实的ip地址为：192.168.100.21
本次访问的页面是index5
预测的ip地址为：192.168.100.30
真实的ip地址为：192.168.100.30
本次访问的页面是index6
预测的ip地址为：192.168.100.31
真实的ip地址为：192.168.100.31
本次访问的页面是index7
预测的ip地址为：192.168.100.40
真实的ip地址为：192.168.100.40
本次访问的页面是index8
预测的ip地址为：192.168.100.41
真实的ip地址为：192.168.100.41
```



## 主要内容

**图片分配到服务器的算法**

m张图片如分配到n个服务器上，保证平均分配，每个网页需要的资源图片是固定的，分配资源的算法有哪些，如何包装一下。

**根据图片的hash值（不太清除hash的生成策略）对服务器的数量取余数（服务器的数量一定要是2的n次方，这样才能包证均匀分布）**

+ 如果是每个图片只存放一张服务器的话，如何分配？
+ 如果是一张图片对应多个服务器，服务器和资源就是多对多的关系，要保证服务器的资源必须平均均匀，有什么算法？

**ip的选择策略**

对应一个图片对应多个服务器映射关系来说，如何选择对应资源的ip

+ 根据映射表优先选择距离近的（同一个局域网段的），再选择不在同一个网段。

+ 轮询，随机。

+ 每个一个图片对应一次连接，**可以动态选择图片列表服务器连接数最小的服务器**

+ 也可以动态选择请求的响应时间来进行调整，**选择响应时间最短的服务器**


**资源的访问顺序问题**

对应一个图片对应一个服务器的映射关系来说，网页需要的有些资源是否按照一定的顺序，如果网络流量根据资源的某种顺序访问的（比如需要在访问图片m之前一定会访问图片n），就算构造了k匿名，仍然可以按照这个顺序进行判断的标识，缩小筛选范围。如何抵御这种攻击？

**ip识别方法**

+ 根据主ip和托管的ip的关系来唯一识别这个ip （实验已经完成）
+ 根据资源的访问先后顺序来识别这个ip（感觉不太好实验模拟）
